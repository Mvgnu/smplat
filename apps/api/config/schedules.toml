# meta: schedules: bundle-experiments
timezone = "UTC"

[jobs.bundle_acceptance_aggregation]
id = "bundle-acceptance-aggregation"
task = "smplat_api.jobs.bundle_acceptance.run_aggregation"
cron = "*/30 * * * *"
max_attempts = 3
base_backoff_seconds = 60
max_backoff_seconds = 600
jitter_seconds = 15

[jobs.bundle_acceptance_aggregation.kwargs]
lookback_days = 30

[jobs.bundle_guardrail_evaluation]
id = "bundle-guardrail-evaluation"
task = "smplat_api.jobs.bundle_guardrails.run_guardrail_evaluation"
cron = "*/5 * * * *"
max_attempts = 4
base_backoff_seconds = 15
max_backoff_seconds = 120
jitter_seconds = 5

[jobs.loyalty_progression_sweep]
id = "loyalty-progression-sweep"
task = "smplat_api.jobs.loyalty.progression.run_loyalty_progression"
cron = "15 * * * *"
max_attempts = 3
base_backoff_seconds = 30
max_backoff_seconds = 300
jitter_seconds = 10

[jobs.loyalty_nudge_aggregation]
id = "loyalty-nudge-aggregation"
task = "smplat_api.jobs.loyalty.nudges.aggregate_loyalty_nudges"
cron = "*/10 * * * *"
max_attempts = 3
base_backoff_seconds = 30
max_backoff_seconds = 300
jitter_seconds = 10

[jobs.loyalty_nudge_dispatcher]
id = "loyalty-nudge-dispatcher"
task = "smplat_api.jobs.loyalty.nudge_dispatcher.dispatch_loyalty_nudges"
cron = "5-59/10 * * * *"
max_attempts = 3
base_backoff_seconds = 30
max_backoff_seconds = 300
jitter_seconds = 10

[jobs.loyalty_analytics_snapshot]
id = "loyalty-analytics-snapshot"
task = "smplat_api.jobs.loyalty.analytics.capture_loyalty_analytics_snapshot"
cron = "0 3 * * *"
max_attempts = 3
base_backoff_seconds = 60
max_backoff_seconds = 600
jitter_seconds = 20

[jobs.checkout_recovery_monitor]
id = "checkout-recovery-monitor"
task = "smplat_api.jobs.checkout_recovery.monitor_checkout_orchestrations"
cron = "*/30 * * * *"
max_attempts = 3
base_backoff_seconds = 45
max_backoff_seconds = 300
jitter_seconds = 10

[jobs.fulfillment_provider_health]
id = "fulfillment-provider-health"
task = "smplat_api.jobs.fulfillment.provider_health.run_provider_health_snapshot"
cron = "*/15 * * * *"
max_attempts = 3
base_backoff_seconds = 60
max_backoff_seconds = 600
jitter_seconds = 15

[jobs.fulfillment_provider_health.kwargs]
timeout_seconds = 8
concurrency = 5

[jobs.fulfillment_provider_balance]
id = "fulfillment-provider-balance"
task = "smplat_api.jobs.fulfillment.provider_balance.run_provider_balance_snapshot"
cron = "*/30 * * * *"
max_attempts = 3
base_backoff_seconds = 45
max_backoff_seconds = 300
jitter_seconds = 10

[jobs.fulfillment_provider_balance.kwargs]
timeout_seconds = 8
concurrency = 5

[jobs.preset_event_alerts]
id = "preset-event-alerts"
task = "smplat_api.jobs.preset_event_alerts.run_preset_alerts"
cron = "30 2 * * *"
max_attempts = 3
base_backoff_seconds = 60
max_backoff_seconds = 600
jitter_seconds = 20

[jobs.preset_event_metrics]
id = "preset-event-metrics"
task = "smplat_api.jobs.preset_event_metrics.run_metric_backfill"
cron = "0 2 * * *"
max_attempts = 3
base_backoff_seconds = 60
max_backoff_seconds = 600
jitter_seconds = 20
